% !TEX root = userguide_jp.tex
%----------------------------------------------------------
\chapter{チュートリアル}
\label{Ch:model}

\section{サンプルファイル一覧}

mVMCでは\verb|sample/Standard/|以下に次のサンプルを用意しています。

\begin{itemize}
\item 2次元正方格子Hubbardモデル

  (\verb|sample/Standard/Hubbard/square/|)
\item 2次元三角格子Hubbardモデル

  (\verb|sample/Standard/Hubbard/triangular/|)
\item 1次元近藤格子モデル

  (\verb|sample/Standard/Kondo/chain/|)
\item 1次元反強磁性的Heisenbergモデル

  (\verb|sample/Standard/Spin/HeisenbergChain/|)
\item 2次元正方格子反強磁性的Heisenbergモデル

  (\verb|sample/Standard/Spin/HeisenbergSquare/|)
  
\item 2次元カゴメ格子反強磁性的Heisenbergモデル

  (\verb|sample/Standard/Spin/Kagome/|)

\end{itemize}

これらのチュートリアルの実行方法は全て同じ手順で実行することが可能です。
以下ではHeisenberg模型について説明します。


% !TEX root = userguide_jp.tex
\section{Heisenberg模型}

以下のチュートリアルはディレクトリ
\begin{verbatim}
sample/Standard/Spin/HeisenbergChain/
\end{verbatim}
内で行います。
このディレクトには以下のファイルがあります.

Heisenberg模型におけるサンプル入力ファイル: \verb|StdFace.def|

参照用出力ディレクトリ: \verb|reference/|

この例では1次元のHeisenberg鎖(最近接サイト間の反強磁性的スピン結合のみを持つ)を考察します。
\begin{align}
  {\hat H} = J \sum_{i=1}^{N_{\rm site}} {\hat {\boldsymbol S}}_i \cdot {\hat {\boldsymbol S}}_{i+1}
\end{align}

インプットファイルの中身は次のとおりです。
\\
\begin{minipage}{10cm}
\begin{screen}
\begin{verbatim}
L = 16
Lsub=4
model = "Spin"
lattice = "chain lattice"
J = 1.0
2Sz = 0
NMPtrans=1
\end{verbatim}
\end{screen}
\end{minipage}
%
\\
この例ではスピン結合$J=1$(任意単位)とし、サイト数は16としました。

\subsubsection{詳細入力ファイル作成}
スタンダードモードでは詳細入力ファイルの作成を最初に行う必要があります。
実行コマンドと標準出力は次のとおりです。

\vspace{1cm}\hspace{-0.7cm}
\verb|$ |\underline{パス}\verb|/vmcdry.out StdFace.def|
\small
\begin{verbatim}
######  Standard Intarface Mode STARTS  ######

  Open Standard-Mode Inputfile StdFace.def 

  KEYWORD : l                    | VALUE : 16 
  KEYWORD : lsub                 | VALUE : 4 
  KEYWORD : model                | VALUE : spin 
  KEYWORD : lattice              | VALUE : chain 
  KEYWORD : j                    | VALUE : 1.0 
  KEYWORD : nmptrans             | VALUE : 1 

#######  Parameter Summary  #######

  @ Lattice Size & Shape

                L = 16 
             Lsub = 4         
                L = 16        
                W = 1         
           phase0 = 0.00000     ######  DEFAULT VALUE IS USED  ######

  @ Hamiltonian 

               2S = 1           ######  DEFAULT VALUE IS USED  ######
                h = 0.00000     ######  DEFAULT VALUE IS USED  ######
            Gamma = 0.00000     ######  DEFAULT VALUE IS USED  ######
                D = 0.00000     ######  DEFAULT VALUE IS USED  ######
              J0x = 1.00000   
              J0y = 1.00000   
              J0z = 1.00000   

  @ Numerical conditions

             Lsub = 4         
             Wsub = 1         
      ioutputmode = 1           ######  DEFAULT VALUE IS USED  ######

######  Print Expert input files  ######

    qptransidx.def is written.
         filehead = zvo         ######  DEFAULT VALUE IS USED  ######
         filehead = zqp         ######  DEFAULT VALUE IS USED  ######
      NVMCCalMode = 0           ######  DEFAULT VALUE IS USED  ######
     NLanczosMode = 0           ######  DEFAULT VALUE IS USED  ######
    NDataIdxStart = 1           ######  DEFAULT VALUE IS USED  ######
      NDataQtySmp = 1           ######  DEFAULT VALUE IS USED  ######
      NSPGaussLeg = 8           ######  DEFAULT VALUE IS USED  ######
         NMPTrans = 1         
    NSROptItrStep = 1000        ######  DEFAULT VALUE IS USED  ######
     NSROptItrSmp = 100         ######  DEFAULT VALUE IS USED  ######
       NVMCWarmUp = 10          ######  DEFAULT VALUE IS USED  ######
    NVMCIniterval = 1           ######  DEFAULT VALUE IS USED  ######
       NVMCSample = 1000        ######  DEFAULT VALUE IS USED  ######
    NExUpdatePath = 2         
          RndSeed = 123456789   ######  DEFAULT VALUE IS USED  ######
       NSplitSize = 1           ######  DEFAULT VALUE IS USED  ######
           NStore = 0           ######  DEFAULT VALUE IS USED  ######
     DSROptRedCut = 0.00100     ######  DEFAULT VALUE IS USED  ######
     DSROptStaDel = 0.02000     ######  DEFAULT VALUE IS USED  ######
     DSROptStepDt = 0.02000     ######  DEFAULT VALUE IS USED  ######
          NSPStot = 0           ######  DEFAULT VALUE IS USED  ######
      ComplexType = 0           ######  DEFAULT VALUE IS USED  ######
    locspn.def is written.
    trans.def is written.
    interall.def is written.
    jastrowidx.def is written.
    coulombintra.def is written.
    coulombinter.def is written.
    hund.def is written.
    exchange.def is written.
    orbitalidx.def is written.
    gutzwilleridx.def is written.
    namelist.def is written.
    modpara.def is written.
    greenone.def is written.
    greentwo.def is written.

######  Input files are generated.  ######
\end{verbatim}
\normalsize

この実行では、ハミルトニアンの詳細を記述するファイル
\begin{itemize}
\item \verb|locspin.def|
\item \verb|trans.def|
\item \verb|coulombinter.def|
\item \verb|coulombintra.def|
\item \verb|exchange.def|
\item \verb|hund.def|
\item \verb|namelist.def|
\item \verb|modpara.def|
\end{itemize}
と、変分パラメータを設定するファイル
\begin{itemize}
\item \verb|gutzwilleridx.def|
\item \verb|jastrowidx.def|
\item \verb|orbitalidx.def|
\item \verb|qptransidx.def|
\end{itemize}
結果として出力する相関関数の要素を指定するファイル
\begin{itemize}
\item \verb|greenone.def|
\item \verb|greentwo.def|
\end{itemize}
が生成されます。
各ファイルの詳細についてはSec. \ref{Ch:HowToExpert}をご覧ください。

\subsubsection{計算実行}
作成した詳細入力ファイルを読み込み計算を行います。
実行コマンドと標準出力は次のとおりです。

\vspace{1cm}\hspace{-0.7cm}
\verb|$ mpiexec -np |\underline{プロセス数}\verb| |\underline{パス}\verb|/vmc.out namelist.def|

使っているシステムによっては\verb|mpiexec|コマンドではなく\verb|mpirun|や\verb|mpijob|、
\verb|poe|となる場合もあります.

\small

\begin{verbatim}
-----------
Start: Read *def files.
  Read File namelist.def .
  Read File 'modpara.def' for ModPara.
  Read File 'locspn.def' for LocSpin.
  Read File 'trans.def' for Trans.
  Read File 'coulombintra.def' for CoulombIntra.
  Read File 'coulombinter.def' for CoulombInter.
  Read File 'hund.def' for Hund.
  Read File 'exchange.def' for Exchange.
  Read File 'gutzwilleridx.def' for Gutzwiller.
  Read File 'jastrowidx.def' for Jastrow.
  Read File 'orbitalidx.def' for Orbital.
  Read File 'qptransidx.def' for TransSym.
  Read File 'greenone.def' for OneBodyG.
  Read File 'greentwo.def' for TwoBodyG.
End  : Read *def files.
Start: Read parameters from *def files.
End  : Read parameters from *def files.
Start: Set memories.
End  : Set memories.
Start: Initialize parameters.
End  : Initialize parameters.
Start: Initialize variables for quantum projection.
End  : Initialize variables for quantum projection.
Start: Optimize VMC parameters.
End  : Optimize VMC parameters.
-----------
\end{verbatim}

計算実行中に以下のファイルが情報として出力されます。
\\
\begin{minipage}{12cm}
  \begin{screen}
\begin{verbatim}
zvo_SRinfo.dat
zvo_out_001.dat
zvo_time_001.dat
zvo_var_001.dat
zvo_CalcTimer.dat
\end{verbatim}
  \end{screen}
\end{minipage}

なお、\verb|zvo_out_001.dat|には、ビン毎の計算情報として、
\begin{equation}
\langle H \rangle, \langle H^2 \rangle, \frac{\langle H^2 \rangle- \langle H \rangle^2 }{\langle H \rangle^2} \nonumber
\end{equation}
が順に出力されますので、収束性の目安として利用することが可能です。
gnuplotを用いる場合には、次のようにして表示することが出来ます($\langle H \rangle$の場合)。
\begin{verbatim}
plot "zvo_out_001.dat" u 1
\end{verbatim}
各ファイルの詳細についてはSec. \ref{Sec:outputfile}をご覧ください。\\

\subsubsection{計算結果出力}
計算が正常終了すると、エネルギー、エネルギーの分散、
変分パラメータおよび計算実行時間を記載したファイルが出力されます。
以下に、このサンプルでの出力ファイルを記載します。\\
\begin{minipage}{12cm}
\begin{screen}
\begin{verbatim}
gutzwiller_opt.dat
jastrow_opt.dat
orbital_opt.dat
zqp_opt.dat
ClacTimer.dat
\end{verbatim}
\end{screen}
\end{minipage}

各ファイルの詳細についてはSec. \ref{Sec:outputfile}をご覧ください。


\subsubsection{Green関数の計算}
\verb|modpara.def|ファイル中の\verb|NVMCCalMode|を0から1に変更の上、以下のコマンドを実行します。
下記のように
実行時のコマンドライン引数として
\verb|"namelist.dat"|の後ろに\verb|"zqp_opt.dat"|を付け加えることで、
一つ前の計算で最適化された変分パラメータを使用した計算が行われます。

\vspace{1cm}\hspace{-0.7cm}
\verb|$ |\underline{パス}\verb|/vmc.out namelist.def zqp_opt.dat|
\small

計算が終了すると以下のファイルが出力されます。
\\
\begin{minipage}{12cm}
\begin{screen}
\begin{verbatim}
zvo_cisajs_001.dat
zvo_cisajscktalt_001.dat
\end{verbatim}
\end{screen}
\end{minipage}
\\
各ファイルの詳細についてはSec. \ref{Sec:outputfile}をご覧ください。

\section{エキスパートユーザー向け}
mVMCでは、以下の6つに分類される入力ファイルを読み込み、計算実行を行います。
\begin{description}
\item[(1)~List:]詳細入力ファイルの種類と名前を指定するファイル
\item[(2)~Basic parameters:]基本的なパラメータを指定するファイル
\item[(3)~Set Hamiltonian:]ハミルトニアンを指定するファイル 
\item[(4)~Set condition of variational parameters :] 最適化する変分パラメータを指定するファイル
\item[(5)~Initial variational parameters:]変分パラメータの初期値を指定するファイル
\item[(6)~Output:]出力する一体・二体グリーン関数の成分を指定するファイル
\end{description}

上記で分類されるファイルを直接作成・指定することで、より複雑な計算を行うことが可能です。
ファイルの詳細についてはSec. \ref{Ch:HowToExpert}をご覧ください。

